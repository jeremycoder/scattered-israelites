{% extends "base.html" %}
{% load reader_tags %}
{% block title %}{{ meta_title }}{% endblock %}

{% block meta %}
<meta name="description" content="{{ meta_description }}">
<meta property="og:title" content="{{ meta_title }}">
<meta property="og:description" content="{{ meta_description }}">
{% endblock %}

{% block content %}
<nav aria-label="Breadcrumb">
  <ol class="breadcrumb-trail">
    <li><a href="{% url 'book-list' %}">Bible</a></li>
    <li><a href="{% url 'chapter-list' book.slug %}">{{ book.name }}</a></li>
    <li><a href="{% url 'chapter-view' book.slug chapter %}">Chapter {{ chapter }}</a></li>
    <li><a href="{% url 'verse-view' book.slug chapter verse_num %}">Verse {{ verse_num }}</a></li>
    <li><span class="current hebrew">{{ word.surface }}</span></li>
  </ol>
</nav>

<!-- Hero card -->
<div class="word-study-hero">
  <p class="big-hebrew hebrew" dir="rtl">{{ word.surface }}</p>
  {% if comparisons %}
  <p class="hero-nc-badge">Niger-Congo</p>
  {% endif %}
  {% if transliteration %}
  <p class="translit">{{ transliteration }}</p>
  {% endif %}
  {% if gloss %}
  <p class="gloss-large">{{ gloss }}</p>
  {% endif %}
  <p class="location">{{ book.name }} {{ chapter }}:{{ verse_num }} &middot; Word #{{ word.position }}</p>
</div>

<!-- Lemma & Strong's codes -->
<div class="card mb-card">
  <div class="card-body">
    <table class="kv-table">
      {% if lexeme %}<tr><td>Lemma</td><td class="hebrew kv-hebrew" dir="rtl">{{ lexeme.lemma }}</td></tr>{% endif %}
      {% if word.strongs_id %}<tr><td>Strong's</td><td>{{ word.strongs_id }}</td></tr>{% endif %}
      {% if definition %}<tr><td>Definition</td><td class="kv-small">{{ definition }}</td></tr>{% endif %}
    </table>
  </div>
</div>

<!-- Translation card (HebrewTranslation) -->
{% if translation %}
<div class="card mb-card">
  <div class="card-header">Translation</div>
  <div class="card-body">
    <table class="kv-table">
      {% if translation.phrase %}<tr><td>Phrase</td><td>{{ translation.phrase }}</td></tr>{% endif %}
      {% if translation.literal %}<tr><td>Literal</td><td>{{ translation.literal }}</td></tr>{% endif %}
    </table>
  </div>
</div>
{% endif %}

<!-- Morphology -->
{% if analysis %}
<details class="card mb-card morphology-details">
  <summary class="card-header">Morphology</summary>
  <div class="card-body">
    <table class="kv-table">
      <tr><td>Raw Code</td><td class="kv-mono">{{ word.morphology }}</td></tr>
      <tr><td>Part of Speech</td><td>{{ analysis.part_of_speech }}</td></tr>
      {% if analysis.subtype %}<tr><td>Subtype</td><td>{{ analysis.subtype }}</td></tr>{% endif %}
      {% if analysis.binyan %}<tr><td>Binyan</td><td>{{ analysis.binyan }}</td></tr>{% endif %}
      {% if analysis.conjugation %}<tr><td>Conjugation</td><td>{{ analysis.conjugation }}</td></tr>{% endif %}
      {% if analysis.person %}<tr><td>Person</td><td>{{ analysis.person }}</td></tr>{% endif %}
      {% if analysis.gender %}<tr><td>Gender</td><td>{{ analysis.gender }}</td></tr>{% endif %}
      {% if analysis.number %}<tr><td>Number</td><td>{{ analysis.number }}</td></tr>{% endif %}
      {% if analysis.state %}<tr><td>State</td><td>{{ analysis.state }}</td></tr>{% endif %}
      {% if analysis.definiteness %}<tr><td>Definiteness</td><td>{{ analysis.definiteness }}</td></tr>{% endif %}
      {% if analysis.suffix_person %}<tr><td>Suffix Person</td><td>{{ analysis.suffix_person }}</td></tr>{% endif %}
      {% if analysis.suffix_gender %}<tr><td>Suffix Gender</td><td>{{ analysis.suffix_gender }}</td></tr>{% endif %}
      {% if analysis.suffix_number %}<tr><td>Suffix Number</td><td>{{ analysis.suffix_number }}</td></tr>{% endif %}
    </table>
  </div>
</details>
{% endif %}

<!-- Lexical Info card (HebrewLexicalInfo) -->
{% if lexical_info %}
<div class="section-divider">
  <h2>Lexical Info</h2>
</div>
<div class="card mb-card">
  <div class="card-body">
    <table class="kv-table">
      {% if lexical_info.root %}<tr><td>Root</td><td class="hebrew kv-hebrew" dir="rtl">{{ lexical_info.root }}</td></tr>{% endif %}
      {% if lexical_info.root_consonants %}<tr><td>Root Consonants</td><td>{{ lexical_info.root_consonants }}</td></tr>{% endif %}
      {% if lexical_info.gloss_basic %}<tr><td>Basic Gloss</td><td>{{ lexical_info.gloss_basic }}</td></tr>{% endif %}
      {% if lexical_info.sense %}<tr><td>Sense</td><td>{{ lexical_info.sense }}</td></tr>{% endif %}
    </table>
  </div>
</div>
{% endif %}

<!-- Word Construction table -->
{% if morphemes %}
<div class="section-divider">
  <h2>Word Construction</h2>
</div>
<div class="card mb-card">
  <table class="detail-table">
    <thead>
      <tr>
        <th>Slot</th>
        <th>Type</th>
        <th class="text-right">Form</th>
        <th>Gloss</th>
        <th class="col-hide-mobile">Root</th>
        <th class="col-hide-mobile">Binyan</th>
        <th class="col-hide-mobile">PGN</th>
      </tr>
    </thead>
    <tbody>
      {% for m in morphemes %}
      <tr>
        <td class="col-muted">{{ m.slot }}</td>
        <td>{{ m.type }}</td>
        <td class="col-hebrew hebrew" dir="rtl">{{ m.form }}</td>
        <td>{{ m.gloss|default:"" }}</td>
        <td class="col-hide-mobile">{% if m.root %}<span class="hebrew" dir="rtl">{{ m.root }}</span>{% endif %}</td>
        <td class="col-hide-mobile">{{ m.binyan|default:"" }}</td>
        <td class="col-muted col-hide-mobile">{% if m.person %}{{ m.person }}{% endif %}{% if m.gender %}{{ m.gender }}{% endif %}{% if m.number %}{{ m.number }}{% endif %}</td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
</div>
{% endif %}

<!-- Niger-Congo Connections -->
{% if comparisons %}
<div class="section-divider">
  <h2 style="color: #2e7d32;">Niger-Congo Hebrew</h2>
</div>
<p class="nc-intro">Many Niger-Congo languages preserve ancient Hebrew vocabulary carried by Israelites scattered into Sub-Saharan Africa &mdash; first during the Assyrian conquest of the Northern Kingdom in 721 B.C., and again after the Roman conquest of Judea in A.D.&nbsp;70. These are the Hebrews &ldquo;beyond the rivers of Kush&rdquo; (Zephaniah 3:10).</p>
{% for comp in comparisons %}
<div class="card mb-card comparison-card">
  <div class="card-header">
    <span class="hebrew" dir="rtl">{{ comp.hebrew_word }}</span>
    <span class="comparison-arrow">&harr;</span>
    <span class="comparison-word">{{ comp.nc_word }}</span>
    <span class="comparison-lang">({{ comp.language }})</span>
  </div>
  <div class="card-body">
    <table class="kv-table">
      <tr><td>Hebrew meaning</td><td>{{ comp.hebrew_meaning }}</td></tr>
      <tr><td>{{ comp.language }} meaning</td><td>{{ comp.nc_meaning }}</td></tr>
      {% if comp.nc_transliteration %}
      <tr><td>Transliteration</td><td>{{ comp.nc_transliteration }}</td></tr>
      {% endif %}
      <tr><td>Category</td><td>{{ comp.get_category_display }}</td></tr>
      {% if comp.semantic_domain %}
      <tr><td>Semantic domain</td><td>{{ comp.semantic_domain }}</td></tr>
      {% endif %}
      {% if comp.notes %}
      <tr><td>Notes</td><td>{{ comp.notes }}</td></tr>
      {% endif %}
    </table>
  </div>
</div>
{% endfor %}
{% endif %}

<!-- Back link -->
<div class="bottom-nav">
  <a href="{% url 'verse-view' book.slug chapter verse_num %}" class="nav-link">&larr; Back to {{ book.name }} {{ chapter }}:{{ verse_num }}</a>
  <span></span>
</div>
{% endblock %}
