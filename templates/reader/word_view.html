{% extends "base.html" %}
{% load reader_tags %}
{% block title %}{{ meta_title }}{% endblock %}

{% block meta %}
<meta name="description" content="{{ meta_description }}">
<meta property="og:title" content="{{ meta_title }}">
<meta property="og:description" content="{{ meta_description }}">
{% endblock %}

{% block content %}
<nav aria-label="Breadcrumb">
  <ol class="breadcrumb-trail">
    <li><a href="{% url 'book-list' %}">Bible</a></li>
    <li><a href="{% url 'chapter-list' book.slug %}">{{ book.name }}</a></li>
    <li><a href="{% url 'chapter-view' book.slug chapter %}">Chapter {{ chapter }}</a></li>
    <li><a href="{% url 'verse-view' book.slug chapter verse_num %}">Verse {{ verse_num }}</a></li>
    <li><span class="current hebrew">{{ word.surface }}</span></li>
  </ol>
</nav>

<!-- Hero card -->
<div class="word-study-hero">
  <p class="big-hebrew hebrew" dir="rtl">{{ word.surface }}</p>
  {% if transliteration %}
  <p class="translit">{{ transliteration }}</p>
  {% endif %}
  {% if gloss %}
  <p class="gloss-large">{{ gloss }}</p>
  {% endif %}
  <p class="location">{{ book.name }} {{ chapter }}:{{ verse_num }} &middot; Word #{{ word.position }}</p>
</div>

<!-- Translation card (HebrewTranslation) -->
{% if translation %}
<div class="card mb-card">
  <div class="card-header">Translation</div>
  <div class="card-body">
    <table class="kv-table">
      {% if translation.phrase %}<tr><td>Phrase</td><td>{{ translation.phrase }}</td></tr>{% endif %}
      {% if translation.literal %}<tr><td>Literal</td><td>{{ translation.literal }}</td></tr>{% endif %}
    </table>
  </div>
</div>
{% endif %}

<!-- Verse in context -->
<div class="section-divider">
  <h2>Verse in Context</h2>
</div>
<div class="card mb-card">
  <div class="card-body">
    <div class="verse-words">
      {% for w in verse_words %}
      {% if w.id == word.id %}
      <span class="word-cell highlight">
        <span class="word-surface hebrew">{{ w.surface }}</span>
        <span class="word-gloss">{{ glosses|dict_get:w.strongs_id }}</span>
      </span>
      {% else %}
      <a href="{% url 'word-view' book.slug chapter verse_num w.slug %}"
         class="word-cell">
        <span class="word-surface hebrew">{{ w.surface }}</span>
        <span class="word-gloss">{{ glosses|dict_get:w.strongs_id }}</span>
      </a>
      {% endif %}
      {% endfor %}
    </div>
  </div>
</div>

<!-- Morphology + Lexicon side-by-side -->
<div class="section-divider">
  <h2>Grammar &amp; Lexicon</h2>
</div>
<div class="two-col mb-card">
  {% if analysis %}
  <div class="card">
    <div class="card-header">Morphology</div>
    <div class="card-body">
      <table class="kv-table">
        <tr><td>Raw Code</td><td class="kv-mono">{{ word.morphology }}</td></tr>
        <tr><td>Part of Speech</td><td>{{ analysis.part_of_speech }}</td></tr>
        {% if analysis.subtype %}<tr><td>Subtype</td><td>{{ analysis.subtype }}</td></tr>{% endif %}
        {% if analysis.binyan %}<tr><td>Binyan</td><td>{{ analysis.binyan }}</td></tr>{% endif %}
        {% if analysis.conjugation %}<tr><td>Conjugation</td><td>{{ analysis.conjugation }}</td></tr>{% endif %}
        {% if analysis.person %}<tr><td>Person</td><td>{{ analysis.person }}</td></tr>{% endif %}
        {% if analysis.gender %}<tr><td>Gender</td><td>{{ analysis.gender }}</td></tr>{% endif %}
        {% if analysis.number %}<tr><td>Number</td><td>{{ analysis.number }}</td></tr>{% endif %}
        {% if analysis.state %}<tr><td>State</td><td>{{ analysis.state }}</td></tr>{% endif %}
        {% if analysis.definiteness %}<tr><td>Definiteness</td><td>{{ analysis.definiteness }}</td></tr>{% endif %}
        {% if analysis.suffix_person %}<tr><td>Suffix Person</td><td>{{ analysis.suffix_person }}</td></tr>{% endif %}
        {% if analysis.suffix_gender %}<tr><td>Suffix Gender</td><td>{{ analysis.suffix_gender }}</td></tr>{% endif %}
        {% if analysis.suffix_number %}<tr><td>Suffix Number</td><td>{{ analysis.suffix_number }}</td></tr>{% endif %}
      </table>
    </div>
  </div>
  {% endif %}

  <div class="card">
    <div class="card-header">Lexicon</div>
    <div class="card-body">
      <table class="kv-table">
        <tr><td>Lemma</td><td class="hebrew kv-hebrew" dir="rtl">{{ word.lemma }}</td></tr>
        {% if word.strongs_id %}<tr><td>Strong's</td><td>{{ word.strongs_id }}</td></tr>{% endif %}
        {% if transliteration %}<tr><td>Transliteration</td><td class="kv-italic">{{ transliteration }}</td></tr>{% endif %}
        {% if gloss %}<tr><td>Gloss</td><td>{{ gloss }}</td></tr>{% endif %}
        {% if definition %}<tr><td>Definition</td><td class="kv-small">{{ definition }}</td></tr>{% endif %}
      </table>
    </div>
  </div>
</div>

<!-- Lexical Info card (HebrewLexicalInfo) -->
{% if lexical_info %}
<div class="section-divider">
  <h2>Lexical Info</h2>
</div>
<div class="card mb-card">
  <div class="card-body">
    <table class="kv-table">
      {% if lexical_info.root %}<tr><td>Root</td><td class="hebrew kv-hebrew" dir="rtl">{{ lexical_info.root }}</td></tr>{% endif %}
      {% if lexical_info.root_consonants %}<tr><td>Root Consonants</td><td>{{ lexical_info.root_consonants }}</td></tr>{% endif %}
      {% if lexical_info.gloss_basic %}<tr><td>Basic Gloss</td><td>{{ lexical_info.gloss_basic }}</td></tr>{% endif %}
      {% if lexical_info.sense %}<tr><td>Sense</td><td>{{ lexical_info.sense }}</td></tr>{% endif %}
    </table>
  </div>
</div>
{% endif %}

<!-- Word Construction table -->
{% if morphemes %}
<div class="section-divider">
  <h2>Word Construction</h2>
</div>
<div class="card mb-card">
  <table class="detail-table">
    <thead>
      <tr>
        <th>Slot</th>
        <th>Type</th>
        <th class="text-right">Form</th>
        <th>Gloss</th>
        <th class="col-hide-mobile">Root</th>
        <th class="col-hide-mobile">Binyan</th>
        <th class="col-hide-mobile">PGN</th>
      </tr>
    </thead>
    <tbody>
      {% for m in morphemes %}
      <tr>
        <td class="col-muted">{{ m.slot }}</td>
        <td>{{ m.type }}</td>
        <td class="col-hebrew hebrew" dir="rtl">{{ m.form }}</td>
        <td>{{ m.gloss|default:"" }}</td>
        <td class="col-hide-mobile">{% if m.root %}<span class="hebrew" dir="rtl">{{ m.root }}</span>{% endif %}</td>
        <td class="col-hide-mobile">{{ m.binyan|default:"" }}</td>
        <td class="col-muted col-hide-mobile">{% if m.person %}{{ m.person }}{% endif %}{% if m.gender %}{{ m.gender }}{% endif %}{% if m.number %}{{ m.number }}{% endif %}</td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
</div>
{% endif %}

<!-- Deep Dive placeholder -->
<div class="deep-dive-placeholder">
  <p class="placeholder-title">Deep Dive</p>
  <p>Comprehensive word study coming soon â€” usage across Scripture, semantic range, and related roots.</p>
</div>

<!-- Back link -->
<div class="bottom-nav">
  <a href="{% url 'verse-view' book.slug chapter verse_num %}" class="nav-link">&larr; Back to {{ book.name }} {{ chapter }}:{{ verse_num }}</a>
  <span></span>
</div>
{% endblock %}
